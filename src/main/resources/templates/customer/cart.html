<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link th:href="@{/assets/css/vendor.css}" rel="stylesheet" />
    <link th:href="@{/assets/css/style.css}" rel="stylesheet" />

    <title th:text="|Cart|">Cart</title>
</head>
<body class="bg-light">

<header th:replace="~{decorator/header :: header}"></header>

<!-- cart -->
<section class="sectionCart">
    <div class="container">
        <div class="row">
            <div class="col">
                <h1 th:text="|Giỏ hàng|">Giỏ hàng</h1>
            </div>
        </div>

	<form th:action="@{/personal/cart/update}" method="POST">
        <div class="row gutter-3 gutter-lg-1">
            <!-- content -->
            <div class="col">
                <!-- order list -->
                <div class="bg-white cart-item-list p-2 p-lg-3 mb-1">
                    <div th:replace="~{decorator/order-cart :: order-cart}"></div>
                </div>
                <a th:href="@{/personal/allproduct}" class="underlined">Tiếp tục mua hàng</a>
                <div class="text-md-right">
                    <button  type="submit" name="action" value="submit1" class=" btn btn-outline-secondary" >Cập nhật giỏ hàng</button>
                </div>

            </div>

            <!-- total order -->
            <aside class="col-lg-4">
                <div class="bg-white p-2 p-lg-3">
                    <h2 class="mb-3 text-uppercase fs-20" th:text="|Tổng hóa đơn|">Tổng hóa đơn</h2>
                    <div th:replace="~{decorator/total_order :: total_order}"></div>
                    <button type="submit" name="action" value="submit2" class="btn btn-primary btn-block">Thanh toán</button>
                </div>
            </aside>
        </div>
        </form>
    </div>
</section>

<footer th:replace="~{decorator/footer :: footer}"></footer>

<script th:src="@{/assets/js/vendor.min.js}"></script>
<script th:src="@{/assets/js/app.js}"></script>
<script>
function updateCartTotal() {
    const checkboxes = document.querySelectorAll('.cart-item-checkbox');
    let subtotal = 0;

    checkboxes.forEach((checkbox) => {
        if (checkbox.checked) {
            const item = checkbox.closest('.cart-item');
            const price = parseInt(item.querySelector('.quantity-price').dataset.price);
            const quantity = parseInt(item.querySelector('.quantity-input').value);
            subtotal += price * quantity;
            console.log(price);
            console.log(quantity);
        }
    });

    
    
    const shipping = 50000; // Phí vận chuyển cố định
    const discount = 0; // Chưa áp dụng giảm giá
    const total = subtotal + shipping - discount;

    // Cập nhật hiển thị
    document.getElementById('subtotal').textContent = subtotal.toLocaleString('vi-VN') + ' ₫';
    document.getElementById('total').textContent = total.toLocaleString('vi-VN') + ' ₫';
}

function changeQuantity(button, change) {
    const quantityInput = button.parentElement.querySelector('.quantity-input');
    let quantity = parseInt(quantityInput.value);
    quantity = isNaN(quantity) ? 1 : quantity;
    quantity += change;
    if (quantity < 1) quantity = 1;
    quantityInput.value = quantity;

    updateCartTotal();
}

// Gọi hàm cập nhật tổng tiền khi trang được tải
document.addEventListener('DOMContentLoaded', function() {
    updateCartTotal();
});

</script>


</body>
</html>
