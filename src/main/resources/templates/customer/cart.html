<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<meta name="viewport"
		  content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link th:href="@{/assets/css/vendor.css}" rel="stylesheet" />
	<link th:href="@{/assets/css/style.css}" rel="stylesheet" />

	<title th:text="|Giỏ hàng|"></title>
</head>
<body class="bg-light">

<header th:replace="~{decorator/header :: header}"></header>

<!-- cart -->
<section class="sectionCart">
	<div class="container">
		<div class="row">
			<div class="col">
				<h1 th:text="|Giỏ hàng|"></h1>
			</div>
		</div>

		<form th:action="@{/personal/cart/update}" method="POST">
			<div class="row gutter-3 gutter-lg-1">
				<!-- content -->
				<div class="col">
					<!-- order list -->
					<div class="bg-white cart-item-list p-2 p-lg-3 mb-1">
						<div th:replace="~{decorator/order-cart :: order-cart}"></div>
						<span th:if="${usercart == null or usercart.isEmpty()}">Không có sản phẩm nào</span>
					</div>
					<a th:href="@{/product/allproduct}" class="underlined">Tiếp tục mua hàng</a>
					<div class="text-md-right">
						<button type="submit" name="action" value="submit1" class=" btn btn-outline-secondary">Cập nhật giỏ hàng</button>
					</div>
				</div>

				<!-- total order -->
				<aside class="col-lg-4">
					<div class="bg-white p-2 p-lg-3">
						<h2 class="mb-3 text-uppercase fs-20" th:text="|Tổng hóa đơn|"></h2>
						<ul class="list-group list-group-minimal mb-3">
							<li class="list-group-item d-flex justify-content-between align-items-center text-uppercase font-weight-bold">
								Tổng thanh toán
								<span id="total" class="price text-red">0 ₫</span>
							</li>
						</ul>
						<button type="submit" name="action" value="submit2" class="btn btn-primary btn-block">
							Thanh toán
						</button>
					</div>
				</aside>
			</div>
		</form>
	</div>
</section>

<footer th:replace="~{decorator/footer :: footer}"></footer>

<script th:src="@{/assets/js/vendor.min.js}"></script>
<script th:src="@{/assets/js/app.js}"></script>

<script>
	function updateCartTotal() {
    let total = 0;

    // Lặp qua tất cả các checkbox để tính tổng
    document.querySelectorAll('.cart-item-checkbox').forEach((checkbox, index) => {
        let priceElement = document.querySelectorAll('.quantity-price')[index];
        let priceString = priceElement.dataset.price;

        // Xử lý loại bỏ dấu phân cách số
        let price = parseFloat(priceString.replace(/[^\d.-]/g, ''));

        let quantityInput = document.querySelectorAll('.quantity-input')[index];
        let quantity = parseInt(quantityInput.value);

        // Kiểm tra giá trị hợp lệ của price và quantity
        if (!isNaN(price) && !isNaN(quantity)) {
            if (checkbox.checked) {
                total += price * quantity;
            }
        } else {
            console.error('Giá trị không hợp lệ. Giá:', price, 'Số lượng:', quantity);
        }
    });

    // Cập nhật tổng thanh toán
    document.getElementById('total').textContent = total.toLocaleString() + ' ₫';
}

document.addEventListener('DOMContentLoaded', updateCartTotal);
document.querySelectorAll('.quantity-input').forEach(input => {
    input.addEventListener('change', updateCartTotal);
});

</script>

</body>
</html>